@model Core.Domain.smSubIndustry
@{
    ViewBag.Title = "Add SubIndustry";
    Layout = null;
}

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")"></script>
@*<script src="~/Scripts/Admin/AddCategory.js"></script>*@

@using (Ajax.BeginForm("AddSubIndustry", "ManageCategory", new AjaxOptions { HttpMethod = "post", InsertionMode = InsertionMode.Replace, OnBegin = "return ValidateSub()", OnSuccess = "AddSubIndustrySuccess(data)" }, new { @id = "AddSubIndustry" }))
{
    @Html.HiddenFor(m => m.IndustryId)
     @Html.HiddenFor(m => m.SubIndustryId)
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header  modal-header-custom">
                <button type="button" class="closemodal" data-dismiss="modal" aria-label="Close" style="float: right"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title modal-title-custom">Add SubIndustry</h4>
            </div>
            <div class="modal-body">
                <div class="social-media-wrap clearfix">
                    @Html.TextBoxFor(m => m.SubIndustryName, new { @placeholder = "Add SubIndustry" })
                    @Html.ValidationMessageFor(m => m.SubIndustryName)
                    @Html.HiddenFor(m => m.IndustryId)
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="closemodal btn btn-circlr" data-dismiss="modal" id="cancelAddPatientComplication" tabindex="900">Close</button>
                <button type="submit" class="btn btn-circlr" id="btnSubCategory" tabindex="800">Save</button>
                
            </div>
        </div>
    </div>
}

<script>



    function AddSubIndustrySuccess(data) {
        debugger;
        if (data.status == true) {
            $("#addSubIndustry").modal("hide");
            $('.modal').css('display', 'none');
            $(".modal-backdrop").remove();

            var popTimer = parseInt($("#hdnPopUpTimer").val());       setTimeout("$.each(BootstrapDialog.dialogs, function(id, dialog){dialog.close();});",popTimer);
            BootstrapDialog.configDefaultOptions({ cssClass: 'bstDialg' });
            BootstrapDialog.show({ title: "<span>Information</span>", type: BootstrapDialog.TYPE_SUCCESS, message: 'SubIndustry added successfully.' });
           // ShowMessage(BootstrapDialog.TYPE_SUCCESS, "SubIndustry added successfully");


            RefreshGrid();
            $('#loadercontainingdiv').addClass("hidden");
        }
        else {
            $("#addSubIndustry").modal("hide");
            $('.modal').css('display', 'none');
            $(".modal-backdrop").remove();
            $('#loadercontainingdiv').addClass("hidden");
           // ShowMessage(BootstrapDialog.TYPE_DANGER, "Error occured");

            var popTimer = parseInt($("#hdnPopUpTimer").val());       setTimeout("$.each(BootstrapDialog.dialogs, function(id, dialog){dialog.close();});",popTimer);
            BootstrapDialog.configDefaultOptions({ cssClass: 'bstDialg' });
            BootstrapDialog.show({ title: "<span>Information</span>", type: BootstrapDialog.TYPE_DANGER, message: 'Error occured.' });
            RefreshGrid();
        }

    }


    function ValidateSub() {
        debugger;
        var isValid = true;
        var SubIndustryName = $("#SubIndustryName", $('#addSubIndustry')).val();
        var industry = $("#IndustryId", $('#addSubIndustry')).val(); 
        $.ajax({
            url: $_UrlCheckDuplicateSubIndustry,
            type: "Get",
            data: { Indusrtyid: industry, subIndustryName: SubIndustryName },
            async: false,
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                if (data == "exists") {
                    debugger;
                    isValid = false;
                    $messageData = $("<span>Information</span>");
                    var popTimer = parseInt($("#hdnPopUpTimer").val());       setTimeout("$.each(BootstrapDialog.dialogs, function(id, dialog){dialog.close();});",popTimer);
                    BootstrapDialog.configDefaultOptions({ cssClass: 'bstDialg' });
                    BootstrapDialog.show({
                        title: $messageData,
                        type: BootstrapDialog.TYPE_DANGER,
                        message: "SubIndustry already exists",
                    });


                }
                else {

                    return isValid;
                }

            },

        });
        return isValid;
    }


    $('.closemodal').click(function () {
        debugger;
        var modal = $("#addSubIndustry");
        modal.modal("hide");
        $('.modal').css('display', 'none');
        $('#loadercontainingdiv').addClass("hidden");
    })
</script>